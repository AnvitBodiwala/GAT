<!DOCTYPE html>
<html>
<head>
    <title>Analysis output</title>
    <meta charset="utf-8"/>
    <link href="../static/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link class="main-stylesheet" href="../static/css/custom.css" rel="stylesheet" type="text/css"/>
    <link class="main-stylesheet" href="../static/css/floatsocial.css" rel="stylesheet" type="text/css"/>
    <link href="{{url_for('static', filename='css/vizStyle.css')}}" rel="stylesheet">
    <link href="../static/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="../static/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <script src="{{url_for('static', filename='js/raphael.min.js')}}"></script>
    <!--<script src="{{url_for('static', filename='js/kartograph.min.js')}}"></script>-->
    <script src="http://kartograph.org/js/kartograph.min.js"></script>
    <script src="{{url_for('static', filename='js/d3.v4.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/interact.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/jquery-1.11.1.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/sorttable.js')}}"></script>
    <script type="text/javascript" src="../static/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../static/js/custom.frontend.js"></script>
    <script type="text/javascript" src="../static/js/vizScript.js"></script>
    <script type="text/javascript">
	  function get(id) {
			return document.getElementById(id);
		}
		function openHelp(source){
			get("help").style.display = "block";
		}
		function closeHelp(source) {
			get("help").style.display = "none";
		}
		// target elements with the "draggable" class
		interact('.draggable')
		  .draggable({
		    // enable inertial throwing
		    inertia: true,
		    // keep the element within the area of it's parent
		    restrict: {
		      restriction: "parent",
		      endOnly: true,
		      elementRect: { top: 0, left: 0, bottom: 1, right: 1 }
		    },
		    // enable autoScroll
		    autoScroll: true,

		    // call this function on every dragmove event
		    onmove: dragMoveListener,
		    // call this function on every dragend event
		    onend: function (event) {
		      var textEl = event.target.querySelector('p');

		      textEl && (textEl.textContent =
		        'moved a distance of '
		        + (Math.sqrt(event.dx * event.dx +
		                     event.dy * event.dy)|0) + 'px');
		    }
		  });

		  function dragMoveListener (event) {
		    var target = event.target,
		        // keep the dragged position in the data-x/data-y attributes
		        x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
		        y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

		    // translate the element
		    target.style.webkitTransform =
		    target.style.transform =
		      'translate(' + x + 'px, ' + y + 'px)';

		    // update the posiion attributes
		    target.setAttribute('data-x', x);
		    target.setAttribute('data-y', y);
		  }

		  // this is used later in the resizing and gesture demos
		  window.dragMoveListener = dragMoveListener;
		interact('.resize-drag-outer')
	  .draggable({
	    onmove: window.dragMoveListener
	  })
	  .allowFrom('.resize-drag')
	  .resizable({
	    preserveAspectRatio: true,
	    edges: { left: true, right: true, bottom: true, top: true }
	  })
	  .on('resizemove', function (event) {
	    var target = event.target,
	        x = (parseFloat(target.getAttribute('data-x')) || 0),
	        y = (parseFloat(target.getAttribute('data-y')) || 0);

	    // update the element's style
	    target.style.width  = event.rect.width + 'px';
	    target.style.height = event.rect.height + 'px';

	    // translate when resizing from top or left edges
	    x += event.deltaRect.left;
	    y += event.deltaRect.top;

	    target.style.webkitTransform = target.style.transform =
	        'translate(' + x + 'px,' + y + 'px)';

	    target.setAttribute('data-x', x);
	    target.setAttribute('data-y', y);
	  });



    </script>
    <style>
		body {
			height:100vh;
		}
		label {
			display: block;
		}
		center {
			color: white;
		}


    </style>

</head>

<style>
* {
 font-size: 100%;
 font-family: Segoe UI;
}


</style>

<body class="resize-container">
<section class="blur">
    <!-- dropdown menu
        The buttons will have to become buttons, indeed-->
    <div class="wrapperul" align="center">
        <ul>
            <li class="dropdown contains-image">
                <a href="{{url_for('upload_blueprint.upload', case_num = case_num)}}"><img
                        src="{{url_for('static', filename='GATLogo.svg')}}" alt="hermes logo"></a>
            </li>
            <li class="dropdown" onclick="show1()">
                <a href="#" class="dropbtn">NLP</a>
            </li>
            <li class="dropdown" onclick="show2()">
                <a href="#" class="dropbtn">SNA</a>
            </li>
            <li class="dropdown" onclick="show3()">
                <a href="#" class="dropbtn">GSA</a>
            </li>
            <li class="dropdown">
                <a href="#" class="dropbtn">View</a>
                <div class="dropdown-content">
                    <a onclick="document.getElementById('GSA Visualization Window').style.display='inline-block'">GSA
                        Visualization</a>
                    <a onclick="document.getElementById('GSA Data Window').style.display='inline-block'">GSA Data</a>
                    <a onclick="document.getElementById('NLP Visualization Window').style.display='inline-block'">NLP
                        Visualization</a>
                    <a onclick="document.getElementById('NLP Data Window').style.display='inline-block'">NLP Data</a>
                    <a onclick="document.getElementById('SNA Visualization Window').style.display='inline-block'">SNA
                        Visualization</a>
                    <a onclick="document.getElementById('SNA Data Window').style.display='inline-block'">SNA Data</a>
                </div>
            </li>
            <li class="dropdown">
                <a href="#" class="dropbtn">Help</a>
                <div class="dropdown-content">
                    <a href="#" onClick="openHelp(this)">GSA Output Help</a>
                    <a href="{{url_for('info_blueprint.help', case_num = case_num)}}">Help Page</a>
                </div>
            </li>
        </ul>
    </div>
    <div id="help" style="display: none;">
        <button onClick="closeHelp(this)">Close Help</button>
        <p><b>Autocorrelation: </b>measures how randomly data is distributed over a space. Global AutoCorrelation is
            more sensitive to global trends, and smaller clumps of similar data do not affect this analysis method on a
            large scale. Local AutoCorrelation is more sensitive locally and gives a smaller-scale autocorrelation
            measure.</p>
        <p><b>Spatial Dynamics: </b>analyzes the evolution of spatial data over time. Here, regions on the map are
            broken up into several categories, depending on the value of the observation at that location. Using Markov
            methods, the probability that a region transitions to a different category is generated. Additionally, mean
            transition times (time for a region to go from category a to category b) are given. In order, the return
            values are as follows: <br>1. A matrix which counts how many a region from one category to another. Most
            entries in this matrix are along the diagonal, as regions tend to stay in the same category, and only
            transition to similar categories. <br>2. The transition probability matrix. <br>3. The steady-state
            distribution matrix, which indicates the probability of a region ending up in category b, given that it
            started in category a. <br>4. The mean transition time matrix.</p>
    </div>
    <!--<div class="bodywrapper">-->
    {% if research_question %}
    <div class="output-window resize-drag-outer" id="Scraped Text Window" style="width: 50%; heigth: 50%">

        <div class="output-button-bar resize-drag">
			<span class="left-span">
				<i class="btn btn-close fa fa-window-close-o"
                   onclick="document.getElementById('Scraped Text').style.display='none'"></i>

				<i class="btn btn-hide fa fa-window-minimize"
                   onclick="handleWindowResizeClick('Scraped Text',this)"></i>
			</span>
            <span class="right-span"><b>Scraped Text</b></span>
        </div>

        <div class="output" id="Scraped Text">
            <br>
            <!--Research question: {{ research_question }}-->
            <div style="text-align:center"><b>{{ research_question[0] }}</b>
                <br>
                Authors: {{research_question[1]}}
                <br>
                Published {{research_question[2]}}
            </div>
            <br>
            <br>
            <p style="line-height:30px">{{research_question[3]}}</p>
            <br>
        </div>
    </div>
    {% endif %}

    {% if error %}
    Note: If you uploaded shapefiles for GSA analysis and nothing is displayed, then it is possible that the generated
    map or the provide CSV has characters/letters that our tool cannot understand.
    {% endif %}

    {% if gsaCSV %}
    <div class="output-window resize-drag-outer" id="GSA Visualization Window" style="width: 50%; heigth: 50%">

        <div class="output-button-bar resize-drag">
			<span class="left-span">
				<i class="btn btn-close fa fa-window-close-o"
                   onclick="document.getElementById('GSA Visualization').style.display='none'"></i>

				<i class="btn btn-hide fa fa-window-minimize"
                   onclick="handleWindowResizeClick('GSA Visualization',this)"></i>
			</span>
            <span class="right-span"><b>GSA Visualization</b></span>
        </div>

        <div class="output" id="GSA Visualization">

            {% if GSA_sample %}
            <a href="{{url_for('gsa_blueprint.reg', case_num = case_num)}}">Click here for regionalization
                visualization</a>
            {% endif %}

            {% if gsaCSV %}
            {% include "kartograph.html" %}
            {% endif %}

        </div>
    </div>

    <div class="output-window resize-drag-outer" id="GSA Data Window">

        <div class="output-button-bar resize-drag">
			<span class="left-span">
				<i class="btn btn-close fa fa-window-close-o"
                   onclick="document.getElementById('GSA Data').style.display='none'"></i>

				<i class="btn btn-hide fa fa-window-minimize"
                   onclick="handleWindowResizeClick('GSA Data',this)"></i>
			</span>
            <span class="right-span"><b>GSA Data</b></span>
        </div>

        <div class="output" id="GSA Data">

            {% if GSA_sample %}
            <p id="gsa_year" style="font-weight:bold;">Autocorrelation Statistics:</p>
            <p id="local_autocorrelation">Local Autocorrelation: {{ auto[0] }}</p>
            <p id="global_autocorrelation">Global Autocorrelation: {{ auto[1] }}</p><br>

            <p><b>Spatial Dynamics Statistics</b></p>
            <p>Transition Counts:<br> {% for row in sp_dyn[0] %}{{row}}<br>{% endfor %}</p>
            <p>Transition Probabilities:<br> {% for row in sp_dyn[1] %}{{row}}<br>{% endfor %}</p>
            {% if sp_dyn[2] != None %}
            <p>Steady State Distributions:<br> {% for row in sp_dyn[2] %}{{row}}<br>{% endfor %}</p>
            {% endif %}
            <p>Mean Passage Time:<br> {% for row in sp_dyn[3] %}{{row}}<br>{% endfor %}</p>

            {% endif %}

        </div>
        <!--	</div> -->


        <br>
        <br>
        {% endif %}

        {% if nlp_summary %}
        <div class="output-window resize-drag-outer" id="NLP Visualization Window">

            <div class="output-button-bar resize-drag">
			<span class="left-span">
				<i class="btn btn-close fa fa-window-close-o"
                   onclick="document.getElementById('NLP Visualization').style.display='none'"></i>

				<i class="btn btn-hide fa fa-window-minimize"
                   onclick="handleWindowResizeClick('NLP Visualization',this)"></i>
			</span>
                <span class="right-span"><b>NLP Visualization</b></span>
            </div>

            <div class="output" id="NLP Visualization">
                <div class="wrapper" style="height: 100%;width: 100%;">
                    <h1>
                        <center>Natural Language Processing</center>
                    </h1>
                    <div class="tab">
                        <input id="tab-sum" type="checkbox" name="tabs">
                        <label for="tab-sum">Corpus Statistics</label>
                        <div class="tab-content">
                            <p>Number of documents analyzed: {{nlp_summary[0]}}<br>
                                Total document word count: {{nlp_summary[2]}}<br>
                            <center>Document length distribution
                                <image src="out/nlp/{{ nlp_summary[1] }}" width="90%" height="50%"></image>
                            </center>
                            </p>
                        </div>
                    </div>
                    {% if False %}
                    <div class="tab">
                        <input id="tab-one" type="checkbox" name="tabs">
                        <label for="tab-one">Entity Sentiment</label>
                        <div class="tab-content">
                            <table class="sortable" border="2px">
                                <tr>
                                    <th>Name</th>
                                    <th>Uses</th>
                                    <th>Positive</th>
                                    <th>Neutral</th>
                                    <th>Negative</th>
                                    <th><strong>Composite</strong></th>
                                </tr>
                                {% for entity in nlp_entities %}
                                <tr>
                                    <td>{{entity[0]}}</td>
                                    <td>{{entity[5]}}</td>
                                    <td>{{entity[3]}}</td>
                                    <td>{{entity[2]}}</td>
                                    <td>{{entity[1]}}</td>
                                    <td>{{entity[4]}}</td>
                                </tr>
                                {% endfor -%}
                            </table>
                            <br/>
                        </div>
                    </div>
                    {% endif %}
                    {% if nlp_tropes %}
                    <div class="tab">
                        <input id="tab-two" type="checkbox" name="tabs">
                        <label for="tab-two">Entity Emotions</label>
                        <div class="tab-content">
                            {% for trope in nlp_tropes %}
                            <img src="out/nlp/{{trope}}" height="40%" width="40%"></image>
                            {% endfor -%}
                        </div>
                    </div>
                    {% endif %}
                    {% if nlp_actors %}
                    <div class="tab">
                        <input id="tab-three" type="checkbox" name="tabs">
                        <label for="tab-three">Actor Analysis</label>
                        <div class="tab-content">
                            <p>Person to other category table</p>
                        </div>
                    </div>
                    {% endif %}
                    {% if nlp_network %}
                    <div class="tab">
                        <input id="tab-three" type="checkbox" name="tabs">
                        <label for="tab-three">Entity Network</label>
                        <div class="tab-content">
                            <p>Jgraph 2D picture with link to SNA</p>
                        </div>
                    </div>
                    {% endif %}
                </div>

            </div>
        </div>
        {% endif %}

        <br>
        <br>

        {% if graph %}
        <div class="output-window resize-drag-outer" id="SNA Visualization Window">
            <div class="output-button-bar resize-drag">
			<span class="left-span">
				<i class="btn btn-close fa fa-window-close-o"
                   onclick="document.getElementById('SNA Visualization').style.display='none'"></i>

				<i class="btn btn-hide fa fa-window-minimize"
                   onclick="handleWindowResizeClick('SNA Visualization',this)"></i>
			</span>
                <span class="right-span"><b>SNA Visualization</b></span>
            </div>

            <div class="output" id="SNA Visualization">
                {% if jgdata %}
                <p><a href="{{ url_for('sna_blueprint.jgvis', case_num=case_num) }}" style="color:white">Click here for
                    3D visualization</a></p>
                {% if SNAbpPlot -%}
                <p>2D Visualization:</p>
                <image src="{{url_for('out_blueprint.custom_static', filename='sna/' + SNAbpPlot )}}"></image>
                {% endif -%}
                {% endif %}

            </div>
        </div>

        <div class="output-window resize-drag-outer" id="SNA Data Window">

            <div class="output-button-bar resize-drag">
			<span class="left-span">
				<i class="btn btn-close fa fa-window-close-o"
                   onclick="document.getElementById('SNA Data').style.display='none'"></i>

				<i class="btn btn-hide fa fa-window-minimize"
                   onclick="handleWindowResizeClick('SNA Data',this)"></i>
			</span>
                <span class="right-span"><b>SNA Data</b></span>
            </div>

            <div class="output" id="SNA Data">
                {% if systemMeasures -%}
                <h4>System Measures</h4>
                {% for measure in systemMeasures -%}
                {% if measure not in ['Description','Baseline','Robustness'] -%}
                <p>
                    {{measure}}: {{systemMeasures[measure]}}
                </p>
                {% endif -%}
                {% endfor -%}
                {% endif -%}

                <div id="resilienceInfo">
                    {% if systemMeasures.get("Baseline") == None -%}
                    <form id="resilienceForm" enctype="multipart/form-data" method="post">
                        <input id="resilience" onclick="handleResilienceClick()" name="resilienceSubmit" type="submit"
                               value="Calculate Resilience" href="javascript:void(0)" data-toggle="tooltip"
                               data-placement="left" title="{{systemMeasures['Description']['Resilience']}}">
                    </form>
                    {% else -%}
                    <table id="resilienceTable">
                        <tr>
                            <th style="text-align:center" colspan="3">
                                Resilience
                            </th>
														<td rowspan="1000" class="resilienceGradient">
														</td>
														<td>
															High
														</td>
                        </tr>
                        <tr>
                            <th>
                              Cliques
                            </th>
                            <th>
                              Baseline
                            </th>
														<th>
															Robustness
														</th>
                        </tr>
                        {% for cluster in systemMeasures['Baseline'] -%}
                        <tr>
                            <td class="node">
                                {{ cluster }}
                            </td>
                            <td>
                                {{ systemMeasures['Baseline'][cluster][0] }}
                                <div class="colorCode"
                                     style="background-color:rgb({{systemMeasures['Baseline'][cluster][1]}}%,0%,{{systemMeasures['Baseline'][cluster][2]}}%)"></div>
                            </td>
														<td>
                                {{ systemMeasures['Robustness'][cluster][0] }}
                                <div class="colorCode"
                                     style="background-color:rgb({{systemMeasures['Robustness'][cluster][1]}}%,0%,{{systemMeasures['Robustness'][cluster][2]}}%)"></div>
                            </td>
                        </tr>
                        {% endfor -%}
												<tr>
													<td colspan="4">
													</td>
													<td>
														Low
													</td>
												</tr>
                    </table>
                    {% endif -%}
                </div>

            </div>
        </div>
        {% endif %}

        <br><br><br><br><br>

    </div>
</section>

    {% include 'modal.html' -%}
</body>
</html>
