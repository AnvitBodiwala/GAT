<!DOCTYPE html>



<html>
<head>
	<title>Analysis output</title>
	<link href="{{url_for('static', filename='css/vizStyle.css')}}" rel="stylesheet">
	<meta charset="utf-8"/>
  <script src="http://kartograph.org/js/jquery.min.js"></script>
  <script src="http://kartograph.org/js/raphael.min.js"></script>
  <script src="http://kartograph.org/js/kartograph.min.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="http://code.interactjs.io/v1.2.9/interact.min.js"></script>
	<script src="{{url_for('static', filename='js/jquery-1.11.1.min.js')}}"></script>
  <script type="text/javascript">
	  function get(id) {
			return document.getElementById(id);
		}
		function openHelp(source){
			get("help").style.display = "block";
		}
		function closeHelp(source) {
			get("help").style.display = "none";
		}
		// target elements with the "draggable" class
		interact('.draggable')
		  .draggable({
		    // enable inertial throwing
		    inertia: true,
		    // keep the element within the area of it's parent
		    restrict: {
		      restriction: "parent",
		      endOnly: true,
		      elementRect: { top: 0, left: 0, bottom: 1, right: 1 }
		    },
		    // enable autoScroll
		    autoScroll: true,

		    // call this function on every dragmove event
		    onmove: dragMoveListener,
		    // call this function on every dragend event
		    onend: function (event) {
		      var textEl = event.target.querySelector('p');

		      textEl && (textEl.textContent =
		        'moved a distance of '
		        + (Math.sqrt(event.dx * event.dx +
		                     event.dy * event.dy)|0) + 'px');
		    }
		  });

		  function dragMoveListener (event) {
		    var target = event.target,
		        // keep the dragged position in the data-x/data-y attributes
		        x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
		        y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

		    // translate the element
		    target.style.webkitTransform =
		    target.style.transform =
		      'translate(' + x + 'px, ' + y + 'px)';

		    // update the posiion attributes
		    target.setAttribute('data-x', x);
		    target.setAttribute('data-y', y);
		  }

		  // this is used later in the resizing and gesture demos
		  window.dragMoveListener = dragMoveListener;
		interact('.resize-drag')
	  .draggable({
	    onmove: window.dragMoveListener
	  })
	  .resizable({
	    preserveAspectRatio: true,
	    edges: { left: true, right: true, bottom: true, top: true }
	  })
	  .on('resizemove', function (event) {
	    var target = event.target,
	        x = (parseFloat(target.getAttribute('data-x')) || 0),
	        y = (parseFloat(target.getAttribute('data-y')) || 0);

	    // update the element's style
	    target.style.width  = event.rect.width + 'px';
	    target.style.height = event.rect.height + 'px';

	    // translate when resizing from top or left edges
	    x += event.deltaRect.left;
	    y += event.deltaRect.top;

	    target.style.webkitTransform = target.style.transform =
	        'translate(' + x + 'px,' + y + 'px)';

	    target.setAttribute('data-x', x);
	    target.setAttribute('data-y', y);
	  });

  </script>
	<style>
		body {
			height:100vh;
		}
	</style>

</head>

<style>
* {
 font-size: 100%;
 font-family: Segoe UI;
}
</style>

<body class="resize-container">

	<!-- dropdown menu
		The buttons will have to become buttons, indeed-->
	<ul>
		<li class="dropdown">
			<a href="{{ url_for('upload') }}">Home</a>
		</li>
		<li class="dropdown">
			<a href="#" class="dropbtn" style = "color:grey;">Cases</a>
			<div class="dropdown-content">
			</div>
		</li>
		<li class="dropdown">
			<a href="#" class="dropbtn" style = "color:grey;">GSA</a>
			<div class="dropdown-content">
			</div>
		</li>
		<li class="dropdown">
			<a href="#" class="dropbtn" style = "color:grey;">SNA</a>
			<div class="dropdown-content">
			</div>
		</li>
		<li class="dropdown">
			<a href="#" class="dropbtn" style = "color:grey;">NLP</a>
			<div class="dropdown-content">
			</div>
		</li>
		<li class="dropdown">
			<a href="#" class="dropbtn" style = "color:grey;">Stats</a>
			<div class="dropdown-content">
				<!--a href="#">Summary statistics for...</a>
				<a href="#">Export ... as csv</a-->
			</div>
		</li>
		<li class="dropdown">
			<a href="#" class="dropbtn">View</a>
			<div class="dropdown-content">
				<a onclick="document.getElementById('GSA Visualization Window').style.display='inline-block'">GSA Visualization</a>
				<a onclick="document.getElementById('GSA Data Window').style.display='inline-block'">GSA Data</a>
				<a onclick="document.getElementById('NLP Visualization Window').style.display='inline-block'">NLP Visualization</a>
				<a onclick="document.getElementById('NLP Data Window').style.display='inline-block'">NLP Data</a>
				<a onclick="document.getElementById('SNA Visualization Window').style.display='inline-block'">SNA Visualization</a>
				<a onclick="document.getElementById('SNA Data Window').style.display='inline-block'">SNA Data</a>
			</div>
		</li>
		<li class="dropdown">
			<a href="#" class="dropbtn">Help</a>
			<div class="dropdown-content">
				<a href="#" onClick="openHelp(this)">GSA Output Help</a>
				<a href="#" style="color:grey;">Manual</a>
			</div>
		</li>
	</ul>

	<div id = "help" style = "display: none;">
		<button onClick = "closeHelp(this)">Close Help</button>
		<p><b>Autocorrelation: </b>measures how randomly data is distributed over a space. Global AutoCorrelation is more sensitive to global trends, and smaller clumps of similar data do not affect this analysis method on a large scale. Local AutoCorrelation is more sensitive locally and gives a smaller-scale autocorrelation measure.</p>
		<p><b>Spatial Dynamics: </b>analyzes the evolution of spatial data over time. Here, regions on the map are broken up into several categories, depending on the value of the observation at that location. Using Markov methods, the probability that a region transitions to a different category is generated. Additionally, mean transition times (time for a region to go from category a to category b) are given. In order, the return values are as follows: <br>1. A matrix which counts how many a region from one category to another. Most entries in this matrix are along the diagonal, as regions tend to stay in the same category, and only transition to similar categories. <br>2. The transition probability matrix. <br>3. The steady-state distribution matrix, which indicates the probability of a region ending up in category b, given that it started in category a. <br>4. The mean transition time matrix.</p>
	</div>

	{% if research_question %}
	<br>
	<!--Research question: {{ research_question }}-->
	<div style="text-align:center"><b>{{ research_question[0] }}</b>
	<br>
	Authors: {{research_question[1]}}
	<br>
	Published {{research_question[2]}}
	</div><br>
	<br>
	<p style="line-height:30px">{{research_question[3]}}</p>
	<br>
	{% endif %}
	{% if error %}
		Note: If you uploaded shapefiles for GSA analysis and nothing is displayed, then it is possible that the generated map or the provide CSV has characters/letters that our tool cannot understand.
	{% endif %}
	<hr>

	{% if gsaCSV %}
	<div class = "output-window resize-drag" id = "GSA Visualization Window" style = "width: 50%; heigth: 50%">

		<div class = "output-button-bar">
			<button class="btn-hide"
			onclick="document.getElementById('GSA Visualization').style.display='none'">hide</button>

			<button class="btn-show"
			onclick="document.getElementById('GSA Visualization').style.display='inline-block'">show</button>

			<button class="btn-close"
			onclick="document.getElementById('GSA Visualization Window').style.display='none'">close</button>
		</div>

		<div class = "output" id = "GSA Visualization">
		<h3><center>GSA Visualization</center></h3>

		{% if GSA_sample %}
			<a href="{{url_for('reg')}}">Click here for regionalization visualization</a>
		{% endif %}

		{% if gsaCSV %}
			{% include "kartograph-test.html" %}
		{% endif %}

		</div>
	</div>

	<div class = "output-window resize-drag" id = "GSA Data Window">

		<div class = "output-button-bar">
			<button class="btn-hide"
			onclick="document.getElementById('GSA Data').style.display='none'">hide</button>

			<button class="btn-show"
			onclick="document.getElementById('GSA Data').style.display='inline-block'">show</button>

			<button class="btn-close"
			onclick="document.getElementById('GSA Data Window').style.display='none'">close</button>
		</div>

		<div class = "output" id = "GSA Data">
		<h3><center>GSA Data</center></h3>

		{% if GSA_sample %}
			<p id="gsa_year" style="font-weight:bold;">Autocorrelation Statistics (for year 2008 -- Sample Case):</p>
			<p id = "local_autocorrelation">Local Autocorrelation: {{ auto[0] }}</p>
			<p id = "global_autocorrelation">Global Autocorrelation: {{ auto[1] }}</p><br>

			<p><b>Spatial Dynamics Statistics (from years 1979-2009 -- Sample Case)</b></p>
			<p>Matrix 1:<br> {% for row in sp_dyn[0] %}{{row}}<br>{% endfor %}</p>
			<p>Matrix 2:<br> {% for row in sp_dyn[1] %}{{row}}<br>{% endfor %}</p>
			<p>Matrix 3:<br> {% for row in sp_dyn[2] %}{{row}}<br>{% endfor %}</p>
			<p>Matrix 4:<br> {% for row in sp_dyn[3] %}{{row}}<br>{% endfor %}</p>

		{% endif %}

		</div>
	</div>


	<br>
	<br>
	{% endif %}

	{% if tropes or nltkPlot %}
	<div class = "output-window resize-drag" id = "NLP Visualization Window">

		<div class = "output-button-bar">
			<button class="btn-hide"
			onclick="document.getElementById('NLP Visualization').style.display='none'">hide</button>

			<button class="btn-show"
			onclick="document.getElementById('NLP Visualization').style.display='inline-block'">show</button>

			<button class="btn-close"
			onclick="document.getElementById('NLP Visualization Window').style.display='none'">close</button>
		</div>

		<div class = "output" id = "NLP Visualization" >
		<h3><center>NLP Visualization</center></h3>

			{% if nltkPlot %}
				<img src = "{{url_for('static', filename = 'temp/' + nltkPlot)}}" alt="NLP Plot" style="width:100%;">
			{% endif %}
			{% if tropes %}
				<p><a href="{{ url_for('radarvis', case_num=case_num) }}">Click here for NLP visualizations</a></p>
			{% endif %}

		</div>
	</div>

	{% endif %}
	{% if nlp_data_show %}
	<div class = "output-window resize-drag" id = "NLP Data Window">

		<div class = "output-button-bar">
			<button class="btn-hide"
			onclick="document.getElementById('NLP Data').style.display='none'">hide</button>

			<button class="btn-show"
			onclick="document.getElementById('NLP Data').style.display='inline-block'">show</button>

			<button class="btn-close"
			onclick="document.getElementById('NLP Data Window').style.display='none'">close</button>
		</div>

		<div class = "output" id = "NLP Data" >
		<h3><center>NLP Data</center></h3>

			{% if nlp_sentiment %}

				Sentiment Analysis: <br>
				<li>Sentiment: {{ nlp_sentiment[0] }}</li>
				<li>Positive Probability: {{ nlp_sentiment[1] }}</li>
				<li>Negative Probability: {{ nlp_sentiment[2] }}</li>
				<li>Most Useful Words: {{ nlp_sentiment[3] }}</li>

			{% endif %}

		</div>
	</div>
	{% endif %}

	<br>
	<br>

	{% if graph %}
	<div class = "output-window resize-drag" id = "SNA Visualization Window">

		<div class = "output-button-bar">
			<button class="btn-hide"
			onclick="document.getElementById('SNA Visualization').style.display='none'">hide</button>

			<button class="btn-show"
			onclick="document.getElementById('SNA Visualization').style.display='inline-block'">show</button>

			<button class="btn-close"
			onclick="document.getElementById('SNA Visualization Window').style.display='none'">close</button>
		</div>

		<div class = "output" id = "SNA Visualization">
		<h3><center>SNA Visualization</center></h3>


			{% if jgdata %}
				<!-- Apparently target="_blank" is a security hazard -->
				<p><a href="{{ url_for('jgvis', case_num=case_num) }}">Click here for SNA visualization</a></p>
			{% endif %}

		</div>
	</div>

	<div class = "output-window resize-drag" id = "SNA Data Window">

		<div class = "output-button-bar">
			<button class="btn-hide"
			onclick="document.getElementById('SNA Data').style.display='none'">hide</button>

			<button class="btn-show"
			onclick="document.getElementById('SNA Data').style.display='inline-block'">show</button>

			<button class="btn-close"
			onclick="document.getElementById('SNA Data Window').style.display='none'">close</button>
		</div>

		<div class = "output" id = "SNA Data">
		<h3><center>SNA Data</center></h3>
		<image src="{{url_for('static', filename='temp/')}}{{ SNAbpPlot }}"></image>
		</div>
	</div>
	{% endif %}

	<br><br><br><br><br>

</body>








</html>
