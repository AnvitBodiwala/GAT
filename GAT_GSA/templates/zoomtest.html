
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <script src="http://kartograph.org/js/chroma.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="http://kartograph.org/js/jquery.min.js"></script>
    <script src="http://kartograph.org/js/raphael.min.js"></script>
    <script src="http://kartograph.org/js/kartograph.min.js"></script>
    <script type="text/javascript" src="http://kartograph.org/showcase/panzoom/raphael.pan-zoom.min.js"></script>
</head>
<body>

<script type="text/javascript" src="htttp://kartograph.org/js/chroma.min.js"></script>
<script type="text/javascript">
        $(document).ready(function() {
            //need to figure out how to get these variables from regionalization code to here - question for vinay.
            var regions = {{regionsPy|safe}};
            var length = Object.keys(regions).length;

            console.log(regions);
            //num regions=7
            var color = chroma.scale('Blues').domain([0, 7]);
            var i = 0;
            /*for (i = 0; i < length; i++){
                console.log(color(i));
            }*/
            //initialization
            map = kartograph.map('#map');
            var mymap = {{mymap|safe}};
            map.setMap(mymap);
            //map.loadMap('mymap.svg', function() {
                map.addLayer('mylayer',{
                    styles: {
                            'stroke-width': 0.7,
                            fill: function(d) {console.log(d["state-name"] + " " + regions[d["state-name"]]); return color(regions[d["state-name"]]); },
                            stroke: function(d) { return color(regions[d["state-name"]]).darker(); }
                    },
                });
                var paths = map.getLayer('mylayer').paths;
                var centers = {};
                for (var i = 0; i < paths.length; i++){
                    var bbox = paths[i].vpath._bbox;
                    var center = [(bbox[1] + bbox[3])/2, (bbox[0] + bbox[2])/2];
                    centers[paths[i].data.id] = {location: center, id: paths[i].data.id };
                }

                var div = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);
                for (var i = 0; i < regions.length; i++){
                    var path = document.getElementById("path" + i);
                    path.on("mouseover", function(){div.transition().duration(200).style("opacity", .9);
                        div .html("<p>" + ":<br>" +  "</p>").style("top", (d3.event.pageY - 50) + "px").style("left", (d3.event.pageX ) + "px");})
                    .on("mousemove", function(){div .html("<p>" + ":<br>" + "</p>").style("top", (d3.event.pageY - 50) + "px").style("left", (d3.event.pageX ) + "px");})
                    .on("mouseout", function(){div.transition().duration(500).style("opacity", 0);});

                }
                initPanZoom();
            //});



    		function initPanZoom() {
	    		var panZoom = map.paper.panzoom();
		    	panZoom.enable()

		        setInterval(function() {
		    	    $('h1').html(panZoom.currZoom +' x:'+panZoom.currPos.x.toFixed(0)+' y:'+panZoom.currPos.y.toFixed(0));
		        }, 50);
		        //cursor
		        var css = '<style type="text/css">.grabbing { cursor: url(data:image/x-icon;base64,AAACAAEAICACAAcABQAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAAH/AAAB/wAAA/0AAANsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//+AB///wAf//4AH//+AD///yT/////////////////////////////8=), pointer !important; } .map-controls div { cursor:pointer; font-size: 20px; color: #777; font-weight:bold; font-family: Helvetica; line-height: 28px; text-align:center;border: 1px solid #bbb; } .map-controls div:hover { border: 1px solid #999; color: #000; }</style>';
		        $('body').append(css);

		        //pan zoom controls up and down
		        var ctrls = $('<div />'), up = $('<div>+</div>'), down = $('<div>âˆ’</div>');
		        ctrls
    		    	.addClass('map-controls')
    		    	.css({ position: 'absolute', top: 20, left: 20, 'z-index': 1000 })
    		    	.append(up).append(down);
    		    up.css({ 'border-radius': '14px 14px 0 0', width: 28, height: 28, position: 'absolute',
    		    	top: 0, left: 0, background: '#fff' });
	    	   	down.css({ 'border-radius': '0 0 14px 14px', width: 28, height: 28, position: 'absolute',
		        	top: 29, left: 0, background: '#fff' });

		        $('#map').parent().append(ctrls);

		        up.click(function (e) {
		            panZoom.zoomIn(1);
		            e.preventDefault();
		        });
		        down.click(function (e) {
    		        panZoom.zoomOut(1);
	    	        e.preventDefault();
		        });
		    }
        });

</script>
<div id="map"></div>
</body>
</html>
